<!DOCTYPE html>
<html lang="en">
  <head>
  <title>Managing Ingresses on Kubernetes | NetApp Cloud Docs</title>
  <meta charset="utf-8">
  <meta property="og:title" content="Managing Ingresses on Kubernetes | NetApp Cloud Docs" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://docs.netapp.com/kubernetes-service/us-en/managing-ingresses-on-kubernetes.html" />
	<meta property="og:description" content="Learn how to manage Ingresses on Kubernetes, so that your app can be accessible to other people on the public Internet." />
  <meta property="og:image" content="https://docs.netapp.com/kubernetes-service/us-en/images/logo-tophat-social.png" />
  <meta property="og:image:alt" content="NetApp Logo" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="format-detection" content="telephone=no">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge,chrome=1">
  <meta http-equiv="encoding" content="utf-8">
  <meta http-equiv="nss-type" content="Product Documentation"/>
  <meta http-equiv="nss-subtype" content="User Guide"/>
  
  <meta name="description" content="Learn how to manage Ingresses on Kubernetes, so that your app can be accessible to other people on the public Internet.">
  <meta name="keywords" content=" ">
  

  <!-- Icons -->
  <link rel="icon" href="/kubernetes-service/us-en/images/favicon.ico" type="image/x-icon">

  <!-- RSS Feed -->
  
  <link rel="alternate" type="application/rss+xml" title="NetApp Cloud Docs" href="/kubernetes-service/us-en/feed.xml">
  

  <!-- CSS Definitions: NetApp CSS should be defined after generic css -->

  <!-- Elastic Search -->
  <link rel="stylesheet" href="//cdn.jsdelivr.net/searchkit/0.10.0/theme.css">

  <!-- LUCI CSS Content -->
  <link rel="stylesheet" href="/kubernetes-service/us-en/common/css/esb.min.css">
  <link rel="stylesheet" href="/kubernetes-service/us-en/common/css/netapp-library.min.css">
  <link rel="stylesheet" href="/kubernetes-service/us-en/common/css/doc.css">
  <link rel="stylesheet" href="/kubernetes-service/us-en/common/css/doc-components.css">

  <link rel="stylesheet" href='/kubernetes-service/us-en/css/na-sidebar.css' type='text/css'>
  <link rel='stylesheet' href='/kubernetes-service/us-en/css/na-search.css' type='text/css'>
  <link rel='stylesheet' href='/kubernetes-service/us-en/css/clouddocs.css' type='text/css'>

  <!-- Font awesome seems to affect our GitHub Icon and generic "arrow box" for external links. -->
  <link rel="stylesheet" type="text/css" href="/kubernetes-service/us-en/css/font-awesome.min.css">
  <!-- <link rel="stylesheet" href="/kubernetes-service/us-en/css/customstyles.css"> -->
  <!-- Controls the shadow effect for search dropdown menu -->
  <link rel="stylesheet" href="/kubernetes-service/us-en/css/boxshadowproperties.css">

  <!-- NetApp CSS controls the technical content -->
  <link rel='stylesheet' href='/kubernetes-service/us-en/css/netapp.css' type='text/css'>

  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <!-- Used to import Promise for IE. Required for SearchKit -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.5/bluebird.min.js"></script>
  
    <script src='/kubernetes-service/us-en/js/na-search.js'></script>
  

  
  <link rel='stylesheet' href='/kubernetes-service/us-en/css/na-pagenav.css' type='text/css' id="pagenav-css">
  <script src='/kubernetes-service/us-en/js/na-pagenav.js'></script>
  

  <link rel='stylesheet' href='/kubernetes-service/us-en/css/prism.css' type='text/css'>
  <link rel='stylesheet' href='/kubernetes-service/us-en/css/prism-netapp.css' type='text/css'>

  <script src='/kubernetes-service/us-en/js/clouddocs.js'></script>
  <script src='/kubernetes-service/us-en/js/s_code_impl.js'></script>
  <script src='/kubernetes-service/us-en/js/jquery.navgoco.min.js'></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src='/kubernetes-service/us-en/js/toc.js'></script>
  <script src='/kubernetes-service/us-en/js/customscripts.js'></script>

  <script>
      $(document).ready(function() {
          // Initialize navgoco with default options
          $("#mysidebar").navgoco({
              caretHtml: '',
              accordion: true,
              openClass: 'active', // open
              save: false, // leave false or nav highlighting doesn't work right
              cookie: {
                  name: 'navgoco',
                  expires: false,
                  path: '/'
              },
              slide: {
                  duration: 400,
                  easing: 'swing'
              }
          });

          $("#collapseAll").click(function(e) {
              e.preventDefault();
              $("#mysidebar").navgoco('toggle', false);
          });

          $("#expandAll").click(function(e) {
              e.preventDefault();
              $("#mysidebar").navgoco('toggle', true);
          });

      });

  </script>
  <script>
      $(document).ready(function() {
          $("#tg-sb-link").click(function() {
              $("#tg-sb-sidebar").toggle();
              $("#tg-sb-content").toggleClass('col-md-9');
              $("#tg-sb-content").toggleClass('col-md-12');
              $("#tg-sb-icon").toggleClass('fa-toggle-on');
              $("#tg-sb-icon").toggleClass('fa-toggle-off');
          });
      });
  </script>

  <!-- Controls the i18n Browser Redirection -->
  <script>
    var siteLocales = [];
    
      siteLocales.push("us-en");
    

    standardizeUrl(siteLocales, "clouddocs.netapp.com", "https://docs.netapp.com");
  </script>

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-81697994-3"></script>
  <script>
  if (document.location.hostname === "docs.netapp.com") {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'UA-81697994-3');
  }
  </script>
</head>


  <body class="n-doc__component-detail">
    <a href="#n-main-content" class="visually-hidden">Skip to main content</a>
<div class="n-off-canvas-menu">
  <div class="n-off-canvas-menu__menu">
    <div class="n-off-canvas-menu__menu-inner">
      <div class="n-off-canvas-menu__property-title">NetApp Cloud Docs</div>
      <ul class="n-off-canvas-menu__property-navigation-list">
        <li class="n-off-canvas-menu__property-navigation-list-item ">
          <a href="https://docs.netapp.com/us-en/" class="n-off-canvas-menu__property-navigation-link">
            Home
          </a>
          <div class="n-off-canvas-menu__child-menu">
            <ul class="n-menu__list">

            </ul>
          </div>
        </li>
      </ul>

      <ul class="n-off-canvas-menu__global-navigation-list">
         <li class="n-off-canvas-menu__global-navigation-list-header">More From NetApp</li>
         <li class="n-off-canvas-menu__global-navigation-list-item"><a href="#" class="n-off-canvas-menu__global-navigation-link">Netapp.com</a></li>
      </ul>
    </div>
  </div>
</div>

    <div class="n-off-canvas-menu__content-wrap">
      <!-- Header -->
      <header>
  <!-- Top Hat -->
  <div class="n-top-hat">
    <div class="n-container">
      <div class="n-top-hat__cross-property-nav">
        <ul class="n-top-hat__list">
            <li class="n-top-hat__list-item">
              <a href="http://www.netapp.com" class="n-top-hat__link">NetApp.com</a>
            </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Property Bar -->
  <div class="n-property-bar n-property-bar--v3">
    <div class="n-property-bar__inner-wrap">
      <div class="n-property-bar__menu-toggle">
        <a href="#" class="n-property-bar__menu-toggle-link"><span class="n-property-bar__menu-toggle-text">Menu</span><svg class="n-icon-bars n-property-bar__menu-toggle-icon" aria-labelledby="title">
          <title>bars</title>
          <use xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#bars"></use>
        </svg></a>
      </div>
      <div class="n-property-bar__property-mark n-property-bar__property-mark--has-property-name">
        <a class="n-property-bar__property-link" href="https://docs.netapp.com/us-en/">
          <div class="n-property-bar__logo">
            <svg class="n-icon-netapp-mark n-property-bar__netapp-mark-icon" aria-labelledby="title">
              <title>netapp-mark</title>
              <use xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#netapp-mark"></use>
            </svg>
            <svg class="n-property-bar__logo-svg" aria-labelledby="title">
              <title>NetApp</title>
              <use xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#netapp-logo"></use>
            </svg>
          </div>
          <h2 class="n-property-bar__property-name">Cloud Docs</h2>
        </a>
      </div>

      
      <div id="search-demo-container" class="n-property-bar__search">
        <div id="react-search"></div>
      </div>
      

      <div id="ie-i18n-menu" class="n-property-bar__utils">
        <ul class="n-property-navigation-bar__utils-list">
          <li class="n-property-navigation-bar__utils-list-item ie-i18n-container">
            <a href="#" class="n-property-navigation-bar__utils-link n-property-navigation-bar__nav-link n-property-navigation-bar__language-selector-toggle ie-i18n-link" data-menu-id="n-property-navigation-bar__menu--language-selector">
              <span class="ie-i18n-lang">English</span>
              <svg class="ie-i18n-icon-container" class="n-property-bar__logo-svg" aria-labelledby="title">
                <title>globe</title>
                <use xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#globe" class="n-icon-globe n-globe__icon"></use>
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>

    <div class="n-property-bar__menus">
      <div id="n-property-navigation-bar__menu--language-selector" class="n-menu n-menu--v3">
        <div class="n-language-selector-menu">
          <div class="n-language-selector-menu__header">
            <span class="n-language-selector-menu__title">Select Your Language</span>
          </div>
          <ul class="n-menu__list">
            <li class="n-menu__list-column">
              <ul class="n-menu__list">


                
                
                <li class="n-menu__list-item n-menu__list-item--level-1">
                  <a href="/kubernetes-service/us-en/" class="n-menu__header-text">English</a>
                </li>
                
                
              </ul>
            </li>
          </ul>
          <div class="menu__footer">
            <p>Current Language: English
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>


      <!-- Content -->
      <main role="main" id="n-main-content" class="n-main-content">
        <div class="n-container">
  <div class="n-row">
    <div class="n-doc n-doc__component-list">
      <!-- Sidebar Column -->
      
      <div class="col-md-3" >
          

<ul id="mysidebar" class="nav">
  

  
    <li><a href="index.html">NKS Docs</a></li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Setup and Credentials</a>
      <ul>
        

  
    <li><a href="create-auth-credentials-on-aws.html">AWS Credentials</a></li>
  

  
    <li><a href="find-aws-credentials-for-cvs.html">AWS Credentials for CVS</a></li>
  

  
    <li><a href="create-auth-credentials-on-azure.html">Azure Credentials</a></li>
  

  
    <li><a href="create-auth-credentials-on-gce.html">GCE Credentials</a></li>
  

  
    <li><a href="create-auth-credentials-on-gke.html">GKE Credentials</a></li>
  

  
    <li><a href="register-vmware.html">VMware Credentials</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Application Lifecycle Management</a>
      <ul>
        

  
    <li><a href="alm-quickstart.html">ALM Quickstart Guide</a></li>
  

  
    <li><a href="alm-projects.html">ALM Projects</a></li>
  

  
    <li><a href="alm-applications.html">ALM Applications</a></li>
  

  
    <li><a href="alm-trackers.html">ALM Trackers</a></li>
  

  
    <li><a href="alm-packages.html">ALM Packages</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">NetApp HCI</a>
      <ul>
        

  
    <li><a href="netapp-hci-requirements.html">NetApp HCI Requirements</a></li>
  

  
    <li><a href="hci-enable-nks-for-netapp-hci.html">Enable NKS for NetApp HCI</a></li>
  

  
    <li><a href="create-netapp-hci-cluster.html">Create a NetApp HCI Cluster</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Create a Kubernetes Cluster</a>
      <ul>
        

  
    <li><a href="create-aws-cluster.html">Create an AWS Cluster</a></li>
  

  
    <li><a href="create-aks-cluster.html">Create an AKS Cluster</a></li>
  

  
    <li><a href="create-azure-cluster.html">Create an Azure Cluster</a></li>
  

  
    <li><a href="create-eks-cluster.html">Create an EKS Cluster</a></li>
  

  
    <li><a href="create-gce-cluster.html">Create a GCE Cluster</a></li>
  

  
    <li><a href="create-gke-cluster.html">Create a GKE Cluster</a></li>
  

  
    <li><a href="create-netapp-hci-cluster.html">Create a NetApp HCI Cluster</a></li>
  

  
    <li><a href="create-vmware-cluster.html">Create a VMware Cluster</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Manage Access</a>
      <ul>
        

  
    <li><a href="add-a-user.html">Add a User</a></li>
  

  
    <li><a href="add-a-team.html">Add a Team</a></li>
  

  
    <li><a href="add-a-workspace.html">Add a Workspace</a></li>
  

  
    <li><a href="ssh-to-a-node-in-an-nks-cluster.html">SSH to a Node in an NKS Cluster</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Cluster Lifecycle</a>
      <ul>
        

  
    <li><a href="add-a-kubernetes-master-node.html">Add a Master Node</a></li>
  

  
    <li><a href="add-a-node-pool.html">Add a Node Pool</a></li>
  

  
    <li><a href="upgrade-kubernetes-on-an-nks-cluster.html">Upgrade Kubernetes</a></li>
  

  
    <li><a href="using-the-kubernetes-cloud-backup.html">Using the Kubernetes Cloud Backup</a></li>
  

  
    <li><a href="install-kubectl-to-control-a-kubernetes-cluster.html">Install Kubectl</a></li>
  

  
    <li><a href="intro-to-terraform-on-nks.html">Terraform on NKS</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">API</a>
      <ul>
        

  
    <li><a href="api-basics.html">API Basics</a></li>
  

  
    <li><a href="api-organizations.html">Organizations</a></li>
  

  
    <li><a href="api-workspaces.html">Workspaces</a></li>
  

  
    <li><a href="api-teams.html">Teams</a></li>
  

  
    <li><a href="api-members.html">Members</a></li>
  

  
    <li><a href="api-user.html">User</a></li>
  

  
    <li><a href="api-keysets.html">Keysets</a></li>
  

  
    <li><a href="api-clusters.html">Clusters</a></li>
  

  
    <li><a href="api-nodes.html">Nodes</a></li>
  

  
    <li><a href="api-nodepools.html">Nodepools</a></li>
  

  
    <li><a href="api-federations.html">Federations</a></li>
  

  
    <li><a href="api-istio-mesh.html">Istio Mesh</a></li>
  

  
    <li><a href="api-trusted-charts.html">Trusted Charts</a></li>
  

  
    <li><a href="api-subscription.html">Subscription</a></li>
  

  
    <li><a href="api-invoice.html">Invoices</a></li>
  

  
    <li><a href="api-notifications.html">Notifications</a></li>
  

  
    <li><a href="api-notifications-to-slack.html">Push NKS Notifications to a Slack Channel</a></li>
  


      </ul>
    </li>
  

  
    <!-- Check Container -->
    <li class="subfolders">
      <a href="#">Requirements and Other Details</a>
      <ul>
        

  
    <li><a href="netapp-hci-requirements.html">NetApp HCI Requirements</a></li>
  

  
    <li><a href="nks-requirements.html">NKS Requirements</a></li>
  

  
    <li><a href="whitelist-ports-and-ip-addresses.html">Whitelist Ports and IP Addresses</a></li>
  

  
    <li><a href="cipher-suites.html">Cipher Suites</a></li>
  


      </ul>
    </li>
  

  
    <li><a href="more-resources.html">More Resources</a></li>
  

  
    <li><a href="news.html">What's New</a></li>
  


</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

      </div>
      

      <div class="n-doc__component-detail-content n-doc__component-detail-content--show-code">
        <!-- Begin of page container -->
        <article class="page-content">
          

<div class="n-doc__component-detail-heading-wrap">
  <h1 class="n-doc__component-detail-heading">Managing Ingresses on Kubernetes
    <span>
      
        <a target="_blank" href="https://github.com/NetAppDocs/kubernetes-service/blob/master/managing-ingresses-on-kubernetes.adoc" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit on GitHub</a>
        <a target="_blank" href="https://github.com/NetAppDocs/kubernetes-service/issues/new?body=Page%3A%20[Managing Ingresses on Kubernetes](https://docs.netapp.com/us-en/kubernetes-service/managing-ingresses-on-kubernetes.html)" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Request doc changes</a>
      
    </span>
  </h1>
</div>

<p class="page-details">

<time datetime="2019-07-10 23:36:43 +0000">07/10/2019</time>


<span>Contributors
  
  <a target="_blank" href="https://github.com/ebarcott">
    <img  class="avatar avatar-small"
          alt="ebarcott"
          width="20" height="20"
          src="https://avatars3.githubusercontent.com/u/44878916?v=4"
          style="border-radius: 50%;"/>
  </a>
  
</span>

</p>

<div class="sect1">
<h2 id="table-of-contents">Table of Contents</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="#introduction">Introduction</a></p>
</li>
<li>
<p><a href="#exposing-services-to-the-world">Exposing services to the world</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#pod">Pod</a></p>
</li>
<li>
<p><a href="#service">Service</a></p>
</li>
<li>
<p><a href="#endpoints">Endpoints</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#introducing-ingress">Introducing Ingress</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#what-rules">What rules?</a></p>
</li>
<li>
<p><a href="#what-services">What services?</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#introducing-ingress-controllers">Introducing Ingress Controllers</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#ingress-controller-extensions">Ingress Controller extensions</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#using-ingresses">Using Ingresses</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#backends">Backends</a></p>
</li>
<li>
<p><a href="#ingress-controller">Ingress Controller</a></p>
</li>
<li>
<p><a href="#ingresses">Ingresses</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Almost everyone who is deploying an application on <a href="https://nks.netapp.io">NetApp Kubernetes Service (NKS)</a> would like the app to be accessible to other people on the public internet.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are an independent developer working with a cloud provider, then you&#8217;ll ask, what&#8217;s my public IP address, and what ports are exposed?</p>
</li>
<li>
<p>If you are a developer in a corporation with private data center resources, you&#8217;ll ask, how do I get the load-balancer rules configured for my set of internal hosts (and whom do I need to talk to)?</p>
</li>
<li>
<p>If you are working an application deployed inside a Kubernetes cluster,
you&#8217;ll ask, what&#8217;s going on here at all? How do I let people get n?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you need to expose your Kubernetes services to the world, Ingresses are the way to go. At the time of this writing Ingress is only available in beta, so let&#8217;s see the alternatives first.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="exposing-services-to-the-world">Exposing services to the world</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Your application in a Kubernetes cluster probably contains these items:</p>
</div>
<div class="sect2">
<h3 id="pod">Pod</h3>
<div class="paragraph">
<p>You have already put your carefully-designed set of applications into a set of containers-sharing-resources as a Kubernetes pod. Now how do those processes communicate with others?</p>
</div>
<div class="paragraph">
<p>The pod exposes endpoints usually at the overlay network. That network is not reachable from outside the cluster. You can also use <code>hostPort</code> to expose the endpoint at the host IP, or set <code>hostNetwork: true</code> to use the host&#8217;s network interface from your pod. However, in both scenarios, you should take extra care to avoid port conflicts at the host, and possibly some issues with packet routing and name resolutions. So let&#8217;s assume that we want a risk-free and scalable kubernetes cluster, and we are correctly using pods exposing their functions to the container ports.</p>
</div>
</div>
<div class="sect2">
<h3 id="service">Service</h3>
<div class="paragraph">
<p>Kubernetes services primarily work to interconnect different pod-based applications.  They&#8217;re designed to help make a microservices system scale well internally.  They are not primarily intended for external access, but there are some accepted ways to expose services to external clients.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s simplify services as a routing, balancing and discovery mechanism for the pod&#8217;s endpoints. Services target pods using selectors, and can map container ports to service ports. A service exposes one or more ports, although you usually find that only one is defined.</p>
</div>
<div class="paragraph">
<p>A service can be exposed using 3 <code>ServiceType</code> choices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ClusterIP</code>: The default, only exposed within the cluster.</p>
</li>
<li>
<p><code>NodePort</code>: Uses a port from a cluster defined range (usually 30000-32767) at every cluster node to expose the service.</p>
</li>
<li>
<p><code>LoadBalancer</code>: Setting your cluster kubelet with the parameter <code>--cloud-provider=the-cloud-provider</code> brings some goodies, including the ability to use the provider&#8217;s load balancer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If we choose <code>NodePort</code> to expose our services, we still need an external proxy that uses DNAT to expose more friendly ports. That element also needs to balance on the cluster nodes, which in turn balance again through the service to the internal pods. There is no easy way of adding TLS or simple host header routing rules to the external service.</p>
</div>
<div class="paragraph">
<p>Choosing <code>LoadBalancer</code> is probably the easiest of all methods to get your service exposed to the internet. The problem is that there is no standard way of telling a Kubernetes service about the elements that a balancer requires, again TLS and host headers are left out.</p>
</div>
</div>
<div class="sect2">
<h3 id="endpoints">Endpoints</h3>
<div class="paragraph">
<p>Endpoints are usually automatically created by services unless you are using headless services and adding the endpoints manually. An endpoint is a host:port tuple registered at Kubernetes, and in the service context it is used to route traffic. The service tracks the endpoints as pods that match the selector are created, deleted and modified. Individually, endpoints are not useful to expose services, since they are to some extent ephemeral objects.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you can rely on your cloud provider to correctly implement the LoadBalancer for their API, to keep up-to-date with Kubernetes releases, and you are happy with their management interfaces for DNS and certificates, then setting up your services as type <code>LoadBalancer</code> is quite acceptable. On the other hand, if you want to manage load balancing systems manually and set up port mappings yourself, <code>NodePort</code> is a low-complexity solution.  If you are directly using <code>Endpoints</code> to expose external traffic, perhaps you already know what you are doing (but consider that you might have made a mistake, there could be another option).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given that none of these elements has been designed to expose services to the internet, their functionality may seem limited for this purpose.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introducing-ingress">Introducing Ingress</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Ingress resource is a set of <strong>rules</strong> that map to Kubernetes <strong>services</strong>. Sure, there is a more complex definition, and I&#8217;ll be missing some points, but I still think that "rules to services mapping" is the best way to understand what an Ingress does.</p>
</div>
<div class="paragraph">
<p>Ingress resources are defined purely within Kubernetes as an object that other entities can watch and respond to.</p>
</div>
<div class="sect2">
<h3 id="what-rules">What rules?</h3>
<div class="paragraph">
<p>Supported rules at this beta stage are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>host header: So we can forward traffic based on domain names.</p>
</li>
<li>
<p>paths: Looks for a match at the beginning of the path.</p>
</li>
<li>
<p>TLS: If the ingress adds TLS, it uses HTTPS and a certificate configured through a secret.</p>
<div class="literalblock">
<div class="content">
<pre>When an ingress does not include host header rules, requests without a match use that Ingress and are mapped to the backend service. A typical example is using a 404 page to respond to requests for unmatched sites/paths.</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="what-services">What services?</h3>
<div class="paragraph">
<p>Ingress tries to match requests to rules and forwards them to backends, which are composed of a service and a port (remember that a service can contain multiple ports.</p>
</div>
<div class="paragraph">
<p>To summarize: An Ingress defines how to take a request and (based on host/path/tls) send it to a backend.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="introducing-ingress-controllers">Introducing Ingress Controllers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To grant (or remove) access, an entity must be watching and responding to changes in the services, pods, and Ingresses. That entity is the Ingress controller.  While the Ingress controller does work directly with the Kubernetes API, watching for state changes, it is not coupled as tightly to the Kubernetes source code as the cloud-provider LoadBalancer implementations.</p>
</div>
<div class="paragraph">
<p>Ingress controllers are applications that watch Ingresses in the cluster and configure a balancer to apply those rules. Typically you use an existing Ingress controller that controls a third party balancer like HAProxy, NGINX, Vulcand or Traefik, updating configuration as the Ingress and their underlying elements change.</p>
</div>
<div class="paragraph">
<p>Ingress controllers usually track and communicate with endpoints behind services instead of using services directly. This way some network plumbing is avoided, and we can also manage the balancing strategy from the balancer.</p>
</div>
<div class="sect2">
<h3 id="ingress-controller-extensions">Ingress Controller extensions</h3>
<div class="paragraph">
<p>As of this writing, Ingress doesn&#8217;t support TCP balancing, balancing policies, rewriting, SNI, and many other common balancer configuration parameters. Ingress controller developers have extended the Ingress definition using annotations, but be aware that those annotations are bound to the controller implementation. The Ingress resource is continually evolving, which might make some of these annotations obsolete in the future.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-ingresses">Using Ingresses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This example demonstrates Ingress usage. In the cluster, create:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A backend to receive requests for <code>domain1.io</code>.</p>
</li>
<li>
<p>A pair of backends to receive requests for <code>domain2.io</code>.</p>
</li>
<li>
<p>One whose path begins with <code>/path1</code>.</p>
</li>
<li>
<p>One whose path begins with <code>/path2</code>.</p>
</li>
<li>
<p>A default backend that shows a 404 page.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="backends">Backends</h3>
<div class="paragraph">
<p>You can use any website or service in a container as a backend. Create three backends.</p>
</div>
<div class="paragraph">
<p><strong>echoheaders</strong>: pod/service which contains a webpage that shows information about the received request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---
apiVersion: v1
kind: ReplicationController
metadata:
  name: echoheaders
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: echoheaders
    spec:
      containers:
      - name: echoheaders
        image: gcr.io/google_containers/echoserver:1.4
        ports:
        - containerPort: 8080
        readinessProbe:
          httpGet:
            path: /healthz
            port: 8080
          periodSeconds: 1
          timeoutSeconds: 1
          successThreshold: 1
          failureThreshold: 10
---
apiVersion: v1
kind: Service
metadata:
  name: echoheaders
  labels:
    app: echoheaders
spec:
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
    name: http
  selector:
    app: echoheaders</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>default-http-backend</strong>: pod/service which is a simple 404 static page.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---
apiVersion: v1
kind: ReplicationController
metadata:
  name: default-http-backend
spec:
  replicas: 2
  selector:
    app: default-http-backend
  template:
    metadata:
      labels:
        app: default-http-backend
    spec:
      terminationGracePeriodSeconds: 60
      containers:
      - name: default-http-backend
        # Any image is permissable as long as:
        # 1. It serves a 404 page at /
        # 2. It serves 200 on a /healthz endpoint
        image: gcr.io/google_containers/defaultbackend:1.0
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8080
            scheme: HTTP
          initialDelaySeconds: 30
          timeoutSeconds: 5
        ports:
        - containerPort: 8080
        resources:
          limits:
            cpu: 10m
            memory: 20Mi
          requests:
            cpu: 10m
            memory: 20Mi
---
apiVersion: v1
kind: Service
metadata:
  name: default-http-backend
  labels:
    app: default-http-backend
spec:
  ports:
  - port: 80
    targetPort: 8080
    protocol: TCP
    name: http
  selector:
    app: default-http-backend</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>game2048</strong>: A pod/service which contains a static web page game</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---
apiVersion: v1
kind: ReplicationController
metadata:
  name: game2048
  labels:
    name: game2048
spec:
  replicas: 2
  selector:
    name: game2048
  template:
    metadata:
      labels:
        name: game2048
        version: stable
    spec:
      containers:
      - name: game2048
        image: alexwhen/docker-2048
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: game2048
  labels:
    name: game2048
spec:
  ports:
  - port: 80
    targetPort: 80
  selector:
    name: game2048</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create the backends of your choice with <code>kubectl create -f &#8230;&#8203;</code></p>
</div>
</div>
<div class="sect2">
<h3 id="ingress-controller">Ingress Controller</h3>
<div class="paragraph">
<p>We only use standard functionality for this example, so you should be able to use any Ingress controller. I&#8217;m using the HAProxy Ingress controller, which is included by default with every NKS cluster build at <a href="http://netapp.io" class="bare">http://netapp.io</a>.</p>
</div>
<div class="paragraph">
<p>The HAProxy Ingress controller at NKS is already configured and listening to changes in your Kubernetes cluster. If you prefer to get NGINX, you can also deploy it in any cluster following <a href="https://github.com/kubernetes/contrib/tree/master/ingress/controllers/nginx">these instructions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ingresses">Ingresses</h3>
<div class="paragraph">
<p>Let&#8217;s start by creating the <code>game2048</code> service at the balancer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: game-ingress
spec:
  rules:
  - host: game.domain1.io
    http:
      paths:
      - path:
        backend:
          serviceName: game2048
          servicePort: 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it. We need now to reach HAPRoxy node using the host header <code>game.domain1.io</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use a domain name. Point the A record to the HAProxy node&#8217;s IP address.</p>
</li>
<li>
<p>Use <code>curl -H "Host: game.domain1.io" real.server.address</code></p>
</li>
<li>
<p>Install a browser plugin to add host header, like <a href="https://chrome.google.com/webstore/detail/virtual-hosts/aiehidpclglccialeifedhajckcpedom">Virtual-Hosts</a> for Chrome.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you use a browser, it shows the 2048 game. However, if you try the IP address without that host header, you get a 503 error.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll be fixing that with our next Ingress, the default backend:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: default-http-backend
spec:
  backend:
    serviceName: default-http-backend
    servicePort: 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>default-http-backend</code> serves every request that doesn&#8217;t match an existing rule. Now if you try the IP address without the game host header, you should get a simple 404 page.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s use the flexible <code>echoheaders</code> service to add some path matching:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: echoheaders
spec:
  rules:
  - host: domain2.io
    http:
      paths:
      - path: /path1
        backend:
          serviceName: echoheaders
          servicePort: 80
      - path: /path2
        backend:
          serviceName: echoheaders
          servicePort: 80</code></pre>
</div>
</div>
<div class="paragraph">
<p>In a real-world scenario, you use different services for each path, but for us to test it&#8217;s ok to use the echoheaders service.</p>
</div>
<div class="paragraph">
<p>To test all Ingresses try these requests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>balancer node IP -&#8594; will be sent to <code>default-http-backend</code> (404 default)</p>
</li>
<li>
<p>domain1.io -&#8594; will be sent to <code>game2048</code></p>
</li>
<li>
<p>domain1.io/path1 -&#8594; will be sent to <code>game2048</code> (and it will fail with 404, since game2048 has no resource at that path)</p>
</li>
<li>
<p>domain2.io/path1 -&#8594; will be sent to <code>echoheaders</code></p>
</li>
<li>
<p>domain2.io/path2 -&#8594; will be sent to <code>echoheaders</code></p>
</li>
<li>
<p>domain2.io/path3 -&#8594; will be sent to <code>default-http-backend</code> (404 default)</p>
</li>
<li>
<p>domain2.io -&#8594; will be sent to <code>default-http-backend</code> (404 default)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ingresses are simple and very easy to deploy, and really fun to play with. However, when you plan your Ingresses for production some other factors arise:
- High Availability
- SSL
- Custom configuration
- Troubleshooting</p>
</div>
<div class="paragraph">
<p>However, we leave those questions for a future article.</p>
</div>
</div>
</div>
</div>

        </article>
        <!-- Page Container -->
      </div>

      
      <div class="page-nav-container">
        <nav class="page-nav-fixed">
          <div class="page-nav-title">On this page:</div>
          <ul class="page-nav-inner" id="page-menu"></ul>
        </nav>
      </div>
      

    </div>
  </div>
</div>

      </main>

      <!-- Footer -->
      
      <footer class="n-footer n-footer--v1" style="border-top: solid 10px #DFDFDF;">
        <div class="n-footer__bottom">
          <div class="n-container">
            <div class="n-footer__bottom-left">
              <div class="n-footer__copyright">
                  <a href="//www.netapp.com/us/legal/copyright.aspx" class="n-footer__copyright-link">© 2019 NetApp, Inc.</a>
              </div>
              <div class="n-footer__copyright">
                <a href="//www.netapp.com/us/legal/index.aspx" class="n-footer__copyright-link">Legal</a>
              </div>
              <div class="n-footer__social-links n-footer__copyright">
                <ul class="n-footer__social-link-list">
                  <li class="n-footer__social-link-list-item">
                    <a class="n-footer__social-link" data-ntap-social="follow-blog" href="http://blog.netapp.com" target="_blank" title="blog" alt="blog">
                      <span class="n-footer__social-link-text">blog</span>
                      <svg class="n-icon-blog n-footer__social-link-icon" aria-labelledby="title">
                        <title>blog@</title>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#blog"></use>
                      </svg>
                    </a>
                  </li>
                  <li class="n-footer__social-link-list-item">
                    <a class="n-footer__social-link" data-ntap-social="follow-community" href="http://community.netapp.com/" target="_blank" title="community" alt="community">
                      <span class="n-footer__social-link-text">community</span>
                      <svg class="n-icon-twitter n-footer__social-link-icon" aria-labelledby="title">
                        <title>community@</title>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#comments"></use>
                      </svg>
                    </a>
                  </li>

                  <li class="n-footer__social-link-list-item">
                    <a class="n-footer__social-link" data-ntap-social="follow-twitter" href="https://twitter.com/netappdoc" target="_blank" title="twitter" alt="twitter">
                      <span class="n-footer__social-link-text">twitter</span>
                      <svg class="n-icon-twitter n-footer__social-link-icon" aria-labelledby="title">
                        <title>twitter@</title>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#twitter"></use>
                      </svg>
                    </a>
                  </li>
                  <li class="n-footer__social-link-list-item">
                    <a class="n-footer__social-link" data-ntap-social="follow-youtube" href="https://www.youtube.com/user/NetAppTechCommTV/" target="_blank" title="youtube" alt="youtube">
                      <span class="n-footer__social-link-text">youtube</span>
                      <svg class="n-icon-youtube n-footer__social-link-icon" aria-labelledby="title">
                        <title>youtube@</title>
                        <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/kubernetes-service/us-en/common/svg/sprite.svg#youtube"></use>
                      </svg>
                    </a>
                  </li>
                </ul>
              </div>
            </div>
            <div class="n-footer__bottom-right">
              <div class="n-footer__copyright">
                <a href="https://docs.netapp.com/us-en/contribute/" class="n-footer__copyright-link">Contribute</a>
              </div>
              <div class="n-footer__copyright">
                <a target="_self" class="n-footer__copyright-link" href="javascript:netapp_mailto()">Email your feedback</a>
              </div>
            </div>
          </div>
        </div>
      </footer>

    </div>

    <script src="/kubernetes-service/us-en/common/js/components.js"></script>
    <script src="/kubernetes-service/us-en/common/js/doc-components.js"></script>

    <!-- Elasticsearch JS -->
    <script type="text/javascript" src='/kubernetes-service/us-en/js/bundle.js'></script>

    <!-- Syntax Highlighting -->
    <script type="text/javascript" src='/kubernetes-service/us-en/js/prism.js'></script>
    <script type="text/javascript" src='/kubernetes-service/us-en/js/prism-curl.js'></script>

  </body>

  
</html>
